<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Becoming Catholic - OCIA | Saint Thomas the Apostle</title>

  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.20/index.global.min.css" rel="stylesheet">

  <style>
    body { 
      font-family: Arial, sans-serif; 
      max-width: 900px; 
      margin: 0 auto; 
      padding: 20px; 
      line-height: 1.6; 
      color: #333; 
    }
    h1, h2, h3 { color: #2c3e50; }
    .contact { 
      background: #f8f8f8; 
      padding: 20px; 
      border-radius: 8px; 
      margin: 20px 0; 
    }
    a { color: #0066cc; text-decoration: none; }
    a:hover { text-decoration: underline; }
    ul { list-style-type: disc; padding-left: 25px; }
    #calendar { 
      max-width: 100%; 
      margin: 20px 0; 
      background: white; 
      border-radius: 8px; 
      overflow: hidden; 
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    footer { margin-top: 40px; text-align: center; font-size: 0.9em; color: #777; }
  </style>
</head>
<body>

  <h1>Becoming Catholic</h1>
  <h2>The Order of Christian Initiation of Adults (OCIA)</h2>

  <p><strong>Become Catholic!</strong><br>
  The Order of Christian Initiation of Adults is a program which familiarizes you with the beliefs and traditions of the Roman Catholic Church, helping you explore the core principles of Catholicism. It prepares you to fully embrace our faith community through the sacraments of Baptism, Confirmation, and Eucharist.</p>

  <p>Becoming Catholic is about more than learning scripture and rituals; it's about discovering how to be a disciple of the Lord! We welcome all newcomers to the Catholic faith — whether unbaptized, baptized, seeking confirmation, or simply searching for God.</p>

  <div class="contact">
    <h3>Contact</h3>
    <p>OCIA Coordinators: Rodney & Bessie Geilenfeldt</p>
    <p>Email: <a href="mailto:ocia@stthomascda.org">ocia@stthomascda.org</a></p>
    <p><a href="https://forms.gle/aE6iyy3RnqoAAzbh6" target="_blank">OCIA Inquirer Form</a> (Google Form – fill out to get started!)</p>
  </div>

  <h3>Today's Readings</h3>
  <p>Visit the USCCB site for the daily readings (updates automatically):</p>
  <ul>
    <li><a href="https://bible.usccb.org/readings" target="_blank">Today's Readings – United States Conference of Catholic Bishops</a></li>
  </ul>

  <h3>OCIA Resources</h3>
  <ul>
    <li><a href="https://www.usccb.org/" target="_blank">United States Conference of Catholic Bishops (USCCB)</a></li>
    <li><a href="https://apps.apple.com/us/app/laudate-1-catholic-app/id499428207" target="_blank">Laudate #1 Catholic App</a></li>
    <li><a href="https://hallow.com/" target="_blank">Hallow App</a></li>
    <li><a href="https://www.catholic.com/" target="_blank">Catholic Answers</a></li>
    <li><a href="https://formed.org/" target="_blank">Formed – On Demand Catholic Content</a></li>
  </ul>

  <h3>OCIA Calendar</h3>
  <p>Upcoming meetings and sessions (interactive month view – loaded directly from parish calendar):</p>
  <div id="calendar"></div>

  <!-- ical.js for parsing ICS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ical.js/1.5.0/ical.min.js"></script>

  <!-- FullCalendar JS (global bundle includes core + dayGrid plugin) -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.20/index.global.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const calendarEl = document.getElementById('calendar');
      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',          // Month grid view
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,listWeek'  // Optional: add week/list views
        },
        height: 'auto',                       // Auto-adjust height
        events: function(fetchInfo, successCallback, failureCallback) {
          const icsUrl = 'https://stthomascda.org/icalendar434090.ics';

          fetch(icsUrl)
            .then(response => {
              if (!response.ok) throw new Error('Failed to fetch ICS');
              return response.text();
            })
            .then(icsText => {
              const jcal = ICAL.parse(icsText);
              const comp = new ICAL.Component(jcal);
              const vevents = comp.getAllSubcomponents('vevent');

              const events = [];

              vevents.forEach(vevent => {
                const event = new ICAL.Event(vevent);
                const now = new Date();
                const futureLimit = new Date(now.getFullYear() + 1, now.getMonth(), now.getDate()); // Show up to 1 year ahead

                if (event.isRecurring()) {
                  const iter = event.iterator();
                  let next = iter.next();
                  let count = 0;
                  while (next && count < 50 && next.toJSDate() < futureLimit) {  // Limit to prevent overload
                    const start = next.toJSDate();
                    if (start > now) {
                      events.push({
                        title: event.summary || 'OCIA Event',
                        start: start.toISOString(),
                        end: event.hasEnd() ? event.endDate.toJSDate().toISOString() : null,
                        allDay: !event.startDate.isDate // Infer all-day if no time component
                      });
                    }
                    next = iter.next();
                    count++;
                  }
                } else {
                  const start = event.startDate.toJSDate();
                  if (start > now) {
                    events.push({
                      title: event.summary || 'OCIA Event',
                      start: start.toISOString(),
                      end: event.hasEnd() ? event.endDate.toJSDate().toISOString() : null,
                      allDay: !event.startDate.isDate
                    });
                  }
                }
              });

              successCallback(events);
            })
            .catch(error => {
              console.error('Calendar error:', error);
              failureCallback(error);
            });
        },
        eventDidMount: function(info) {
          // Optional tooltip on hover
          info.el.title = info.event.title + ' (' + info.event.start.toLocaleString() + ')';
        },
        loading: function(isLoading) {
          if (isLoading) {
            calendarEl.innerHTML = '<p style="text-align:center;padding:40px;">Loading calendar...</p>';
          }
        }
      });

      calendar.render();
    });
  </script>

  <footer>
    <p>&copy; Saint Thomas the Apostle Parish | Coeur d'Alene, Idaho</p>
  </footer>

</body>
</html>
