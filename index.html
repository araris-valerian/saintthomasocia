<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Becoming Catholic - OCIA | Saint Thomas the Apostle</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      max-width: 900px; 
      margin: 0 auto; 
      padding: 20px; 
      line-height: 1.6; 
      color: #333; 
    }
    h1, h2, h3 { color: #2c3e50; }
    .contact { 
      background: #f8f8f8; 
      padding: 20px; 
      border-radius: 8px; 
      margin: 20px 0; 
    }
    a { color: #0066cc; text-decoration: none; }
    a:hover { text-decoration: underline; }
    ul { list-style-type: disc; padding-left: 25px; }
    #calendar-events { margin-top: 10px; }
    #calendar-events ul { list-style-type: none; padding-left: 0; }
    #calendar-events li { 
      margin-bottom: 12px; 
      padding: 10px; 
      background: #f9f9f9; 
      border-radius: 6px; 
    }
    #calendar-events .event-summary { font-weight: bold; }
    #calendar-events .event-date { color: #555; font-size: 0.95em; }
    footer { margin-top: 40px; text-align: center; font-size: 0.9em; color: #777; }
  </style>
</head>
<body>

  <h1>Becoming Catholic</h1>
  <h2>The Order of Christian Initiation of Adults (OCIA)</h2>

  <p><strong>Become Catholic!</strong><br>
  The Order of Christian Initiation of Adults is a program which familiarizes you with the beliefs and traditions of the Roman Catholic Church, helping you explore the core principles of Catholicism. It prepares you to fully embrace our faith community through the sacraments of Baptism, Confirmation, and Eucharist.</p>

  <p>Becoming Catholic is about more than learning scripture and rituals; it's about discovering how to be a disciple of the Lord! We welcome all newcomers to the Catholic faith — whether unbaptized, baptized, seeking confirmation, or simply searching for God.</p>

  <div class="contact">
    <h3>Contact</h3>
    <p>OCIA Coordinators: Rodney & Bessie Geilenfeldt</p>
    <p>Email: <a href="mailto:ocia@stthomascda.org">ocia@stthomascda.org</a></p>
    <p><a href="https://forms.gle/aE6iyy3RnqoAAzbh6" target="_blank">OCIA Inquirer Form</a> (Google Form – fill out to get started!)</p>
  </div>

  <h3>Today's Readings</h3>
  <p>Visit the USCCB site for the daily readings (updates automatically):</p>
  <ul>
    <li><a href="https://bible.usccb.org/readings" target="_blank">Today's Readings – United States Conference of Catholic Bishops</a></li>
  </ul>

  <h3>OCIA Resources</h3>
  <ul>
    <li><a href="https://www.usccb.org/" target="_blank">United States Conference of Catholic Bishops (USCCB)</a></li>
    <li><a href="https://apps.apple.com/us/app/laudate-1-catholic-app/id499428207" target="_blank">Laudate #1 Catholic App</a></li>
    <li><a href="https://hallow.com/" target="_blank">Hallow App</a></li>
    <li><a href="https://www.catholic.com/" target="_blank">Catholic Answers</a></li>
    <li><a href="https://formed.org/" target="_blank">Formed – On Demand Catholic Content</a></li>
  </ul>

  <h3>OCIA Calendar</h3>
  <p>Upcoming meetings and sessions (loaded directly from parish calendar – auto-updates when the source changes):</p>
  <div id="calendar-events">Loading events...</div>

  <!-- JavaScript to parse and display the .ics file -->
  <script type="module">
    import ICAL from "https://unpkg.com/ical.js@2.2.1/dist/ical.min.js";

    const icsUrl = "https://stthomascda.org/icalendar434090.ics";
    const eventsContainer = document.getElementById("calendar-events");

    async function loadAndDisplayCalendar() {
      try {
        const response = await fetch(icsUrl);
        if (!response.ok) throw new Error("Failed to fetch calendar");
        const icsText = await response.text();

        const jcal = ICAL.parse(icsText);
        const comp = new ICAL.Component(jcal);
        let vevents = comp.getAllSubcomponents("vevent");

        const now = new Date();
        let upcomingEvents = [];

        vevents.forEach(vevent => {
          const event = new ICAL.Event(vevent);

          // Handle recurring events (simple expansion for next occurrences)
          if (event.isRecurring()) {
            const iter = event.iterator();
            let next = iter.next();
            let count = 0;
            while (next && count < 10) {  // Limit to next 10 instances to avoid overload
              const startDate = next.toJSDate();
              if (startDate > now) {
                upcomingEvents.push({
                  summary: event.summary,
                  start: startDate,
                  end: event.endDate ? event.endDate.toJSDate() : null
                });
              }
              next = iter.next();
              count++;
            }
          } else {
            const startDate = event.startDate.toJSDate();
            if (startDate > now) {
              upcomingEvents.push({
                summary: event.summary,
                start: startDate,
                end: event.endDate ? event.endDate.toJSDate() : null
              });
            }
          }
        });

        // Sort by start date
        upcomingEvents.sort((a, b) => a.start - b.start);

        if (upcomingEvents.length === 0) {
          eventsContainer.innerHTML = "<p>No upcoming events found.</p>";
          return;
        }

        let html = "<ul>";
        upcomingEvents.forEach(ev => {
          const dateStr = ev.start.toLocaleDateString("en-US", {
            weekday: "long", month: "long", day: "numeric", year: "numeric"
          });
          const timeStr = ev.start.toLocaleTimeString("en-US", { hour: "numeric", minute: "2-digit" }) +
                          (ev.end ? " – " + ev.end.toLocaleTimeString("en-US", { hour: "numeric", minute: "2-digit" }) : "");
          html += `<li>
            <div class="event-summary">${ev.summary}</div>
            <div class="event-date">${dateStr} at ${timeStr}</div>
          </li>`;
        });
        html += "</ul>";
        eventsContainer.innerHTML = html;
      } catch (error) {
        console.error("Error loading calendar:", error);
        eventsContainer.innerHTML = "<p>Unable to load calendar events right now. Please check back later or contact the coordinators.</p>";
      }
    }

    loadAndDisplayCalendar();
  </script>

  <footer>
    <p>&copy; Saint Thomas the Apostle Parish | Coeur d'Alene, Idaho</p>
  </footer>

</body>
</html>
